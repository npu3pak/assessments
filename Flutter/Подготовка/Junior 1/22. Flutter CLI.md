# Лекция: Flutter CLI (22. Сборка, запуск, отладка приложений)

---

## **Введение**
Flutter Command Line Interface (CLI) — это инструментарий, который позволяет разработчикам эффективно управлять жизненным циклом мобильных приложений. Он предоставляет набор команд для сборки, запуска, отладки и управления проектами. Для Junior-разработчика понимание Flutter CLI является ключом к быстрому развитию в рамках разработки на Flutter.

В этой лекции мы подробно рассмотрим:
1. **Сборку приложения** (Flutter build).
2. **Запуск приложения** (Flutter run).
3. **Подключение отладчика к приложению** (Flutter devtools, flutter attach).

---

## **1. Сборка приложения**

### **Что такое сборка?**
Сборка — это процесс преобразования исходного кода в исполняемый файл, который может быть запущен на целевом устройстве (например, Android или iOS). В Flutter сборка выполняется через команды `flutter build`, которые компилируют проект и генерируют бинарные файлы.

### **Режимы сборки**
Flutter поддерживает три режима сборки:
- **Debug**: используется для разработки. Содержит отладочную информацию и не оптимизирован для производительности.
- **Release**: окончательный вариант, предназначенный для пользователей. Оптимизирован для производительности и безопасен с точки зрения конфиденциальности данных.
- **Profile**: используется для анализа производительности (например, через Flutter DevTools).

### **Команды сборки**
#### 1. `flutter build [mode]`
Пример:
```bash
flutter build apk --release
```
**Описание:**
- `build` — основная команда сборки.
- `apk` — формат для Android (Android Package Kit).
- `--release` — указывает режим сборки.

#### 2. `flutter build appbundle`
Пример:
```bash
flutter build appbundle
```
**Описание:**
- Генерирует `.aab` файл (Android App Bundle), который можно загрузить в Google Play. Этот формат позволяет оптимизировать размер приложения для разных устройств.

#### 3. `flutter build ios --release`
Пример:
```bash
flutter build ios --release
```
**Описание:**
- Создает бинарный файл для iOS (`.ipa`). Потребуется доступ к Xcode и Mac-компьютеру.

### **Примеры кода с комментариями**

#### Пример 1: Сборка в режиме `debug` для Android
```bash
flutter build apk --debug
```
**Результат:** 
Создается файл `build/app/outputs/apk/debug/app-debug.apk`.

#### Пример 2: Сборка в режиме `release` для iOS
```bash
flutter build ios --release
```
**Примечание:**
- Убедитесь, что установлен Xcode и настроен Flutter для работы с iOS (через команду `flutter doctor`).

### **Важные моменты**
1. **Для Android**: Для сборки `.aab`, используйте `flutter build appbundle`.
2. **Зависимости**: Перед сборкой убедитесь, что все зависимости установлены (`flutter pub get`).
3. **Ошибки при сборке**:
   - Если возникает ошибка `No Java runtime was found`, установите JDK.
   - Для iOS: Убедитесь, что Xcode обновлён и настроен.

---

## **2. Запуск приложения**

### **Что такое запуск приложения?**
Запуск — это процесс, при котором Flutter загружает приложение на устройство или эмулятор для тестирования. Это удобно для быстрой проверки изменений в реальном времени.

### **Основные команды**
#### 1. `flutter run`
Пример:
```bash
flutter run
```
**Описание:**
- Запускает приложение на подключенном устройстве или эмуляторе.
- Автоматически обновляет приложение при изменении кода (Hot Reload).

#### 2. `flutter run --device-id <ID_устройства>`
Пример:
```bash
flutter run --device-id emulator-5554
```
**Описание:**
- Указывает конкретное устройство для запуска.

### **Режимы запуска**
Flutter поддерживает три режима:
- **Debug**: используется по умолчанию, позволяет использовать Hot Reload.
- **Release**: не рекомендуется для тестирования (отсутствует Hot Reload).
- **Profile**: аналогичен Debug, но с отключенными проверками производительности.

### **Примеры кода**

#### Пример 1: Запуск на эмуляторе Android
```bash
flutter run
```
**Результат:** 
Приложение запустится на подключённом эмуляторе или первом доступном устройстве.

#### Пример 2: Запуск на реальном устройстве
1. Подключите телефон к компьютеру.
2. Введите:
```bash
flutter run --device-id <ID_устройства>
```
**Как получить ID устройства?**
- Используйте команду `flutter devices`.

### **Примечания**
1. Для эмулятора Android используйте `emulator -avd <name>`.
2. Если приложение не запускается, проверьте через `flutter doctor` наличие ошибок (например, отсутствие SDK).

---

## **3. Подключение отладчика к приложению**

### **Что такое отладчик?**
Отладчик — это инструмент для анализа работы кода: установка точек останова, просмотр переменных, анализ стека вызовов и т.д.

Flutter поддерживает использование:
- **Visual Studio Code** (с плагином Flutter).
- **Android Studio**.
- **Flutter DevTools** — встроенный инструмент для анализа производительности и отладки.

### **Подключение отладчика через Flutter DevTools**

#### Шаги:
1. Запустите DevTools:
```bash
flutter pub get
flutter devtools
```
2. Откройте браузер по адресу `http://localhost:9100`.

3. В DevTools выберите:
   - **Performance** (анализ производительности).
   - **Memory** (просмотр памяти).
   - **Debugger** (отладка кода).

### **Подключение отладчика к реальному устройству**
#### 1. Используя `flutter attach`
Пример:
```bash
flutter attach --device-id <ID_устройства>
```
**Описание:**
- Подключает текущий процесс приложения на устройстве к отладчику.

#### 2. Используя Android Studio или VS Code
1. В Android Studio/VS Code выберите **Run > Debug Flutter App on Device**.
2. Выберите подключенное устройство.
3. Отладчик будет автоматически подключён.

### **Примеры кода**

#### Пример 1: Использование `flutter attach`
```bash
flutter attach --device-id emulator-5554
```
**Результат:** 
Отладчик подключится к эмулятору с ID `emulator-5554`.

#### Пример 2: Использование DevTools
1. Запустите `flutter devtools`.
2. В DevTools выберите **Performance**.
3. Начните запись и выполните действия в приложении.

### **Важные моменты**
- Для работы с отладчиком убедитесь, что установлен Dart и Flutter SDK.
- Если отладчик не подключается, проверьте через `flutter devices` и `flutter doctor`.

---

## **Практическое задание**

**Задача:**
1. Соберите приложение в режиме **Release** для Android.
2. Запустите его на эмуляторе и реальном устройстве.
3. Подключите Flutter DevTools к запущенному приложению и выполните анализ производительности.

**Инструкции:**
1. Создайте новое приложение:
```bash
flutter create my_app
cd my_app
```
2. Добавьте простой UI (например, кнопку с текстом "Hello World").
3. Соберите в режиме Release:
```bash
flutter build apk --release
```
4. Запустите на эмуляторе:
   - Используйте `flutter run`.
5. Подключите DevTools:
```bash
flutter devtools
```

---

## **Контрольные вопросы**

1. Какие режимы сборки существуют в Flutter? В чём их отличие?
2. Что делает команда `flutter build apk` и какая она используется?
3. Для чего нужен режим `Profile` при сборке приложения?
4. Как запустить приложение на реальном устройстве через Flutter CLI?
5. Как подключить отладчик к приложению, работающему в эмуляторе?
6. Что такое Flutter DevTools и для чего он используется?
7. Как проверить список доступных устройств через Flutter CLI?
8. Чем отличается `flutter run` от `flutter build`?

---

## **Список литературы и ссылки**

1. **Официальная документация Flutter**  
   [https://docs.flutter.dev](https://docs.flutter.dev)  
   *Рекомендуется изучить раздел "Command Line Tools".*

2. **Flutter CLI Reference (официальный)**  
   [https://docs.flutter.dev/flutter/flutter_command_line_tools.html](https://docs.flutter.dev/flutter/flutter_command_line_tools.html)

3. **Книга: "Flutter in Action" by Alan D. Smith**  
   *Полное руководство по Flutter, включая работу с CLI.*

4. **Video Course: "Flutter DevTools Deep Dive" на YouTube (channel: "Flutter")**  
   [https://www.youtube.com/playlist?list=PLjx3RlQn8V7IjzX60s7K2uXpWJUq91Sf5](https://www.youtube.com/playlist?list=PLjx3RlQn8V7IjzX60s7K2uXpWJUq91Sf5)

5. **Статья: "Understanding Flutter Build Modes" (Flutter Community Blog)**  
   [https://medium.com/flutter/understanding-flutter-build-modes-4bfae83c3d](https://medium.com/flutter/understanding-flutter-build-modes-4bfae83c3d)

6. **Flutter Doctor: как использовать**  
   [https://docs.flutter.dev/getting-started/troubleshooting#flutter-doctor](https://docs.flutter.dev/getting-started/troubleshooting#flutter-doctor)

---

## **Заключение**

Понимание Flutter CLI — это фундамент для работы с любым Flutter-проектом. Команды сборки (`build`), запуска (`run`) и отладки (`devtools`, `attach`) позволяют разработчику быстро тестировать, устранять ошибки и готовить проект к релизу.

Изучив эту лекцию, вы сможете:
- Собрать приложение в любых режимах.
- Запустить его на эмуляторе или реальном устройстве.
- Использовать мощные инструменты отладки Flutter DevTools.

Продолжайте практиковаться — это ключ к успеху!