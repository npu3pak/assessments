# Лекция 13: FVM (Flutter Version Manager)  
**Тема**: Работа с версиями Flutter через FVM  
**Цель**: Научиться управлять версиями Flutter в проектах, используя FVM для изоляции и управления зависимостями.  

---

## 1. Описание FVM (Flutter Version Manager)  

FVM — это инструмент, который позволяет разработчикам управлять несколькими версиями Flutter в одном проекте или на уровне системы. Он решает проблему конфликтов между требованиями разных проектов к версии Flutter и избавляет от необходимости переключаться между глобальными установками через `flutter upgrade` или удаление/переустановку SDK.  

**Зачем нужен FVM?**  
- **Изоляция**: Каждый проект может использовать свою собственную версию Flutter, без влияния на системные настройки.  
- **Гибкость**: Удобно тестировать приложения под разными версиями Flutter (например, для поддержки старых устройств или багфиксов).  
- **Совместимость**: Если в команде работают разработчики с разными требованиями к версии Flutter, FVM позволяет каждому использовать нужную версию локально.  

**Как работает FVM?**  
FVM устанавливает и управляет несколькими версиями Flutter в отдельной директории (например, `~/.fvm/`). При запуске проекта он подгружает нужную версию SDK из этой папки. Это отличается от стандартного подхода Flutter, где глобальная версия устанавливается через `flutter upgrade` и используется для всех проектов.  

---

## 2. Подключение FVM к проекту  

Чтобы использовать FVM в проекте, необходимо:  
1. **Установить FVM** (если он не установлен).  
2. **Настроить проект**, чтобы он использовал FVM вместо глобальной версии Flutter.  

### Шаг 1: Установка FVM  
FVM устанавливается через `pub` или `dart`. В терминале выполните:  
```bash
# Через pub (рекомендуется для проектов на Dart)
dart pub global activate fvm

# Или через dart
dart pub global activate fvm
```
После установки FVM будет доступен глобально. Проверьте версию:  
```bash
fvm --version
```

### Шаг 2: Подключение проекта к FVM  

1. **Создайте новый Flutter-проект** (или используйте существующий):  
   ```bash
   flutter create my_app
   cd my_app
   ```

2. **Инициализация FVM в проекте**:  
   В корне проекта выполните команду:  
   ```bash
   fvm init
   ```
   Это создаст файл `fvm.yaml`, в котором будут храниться настройки FVM для этого проекта.  

3. **Проверьте структуру проекта после инициализации**:  
   В корне проекта появится директория `.fvm/`, где будет храниться копия Flutter SDK, которую вы установите через FVM.  

---

## 3. Настройка используемой версии Flutter  

FVM позволяет устанавливать и управлять конкретными версиями Flutter в проекте. Это особенно полезно для тестирования приложения под разные версии SDK или для совместимости с библиотеками, которые требуют определённой версии.  

### Установка конкретной версии Flutter через FVM  

1. **Список доступных версий**:  
   Чтобы увидеть все доступные версии Flutter, выполните:  
   ```bash
   fvm list
   ```
   Это покажет список всех версий, которые можно установить. Пример вывода:  
   ```
   Available versions:
     stable (2.19)
     dev (3.0.0-57.0.pre)
     2.18.6
     2.17.6
     ...
   ```

2. **Установка версии для проекта**:  
   Используйте команду `fvm use` с указанием нужной версии:  
   ```bash
   fvm use 2.18.6
   ```
   FVM установит указанную версию Flutter в директорию `.fvm/` вашего проекта и обновит файл `fvm.yaml`.  

3. **Проверка текущей версии**:  
   Убедитесь, что FVM использует правильную версию:  
   ```bash
   fvm flutter --version
   ```
   Если всё правильно, вывод будет содержать номер установленной версии (например, `2.18.6`).  

**Пример:**  
Если в проекте требуется использовать версию Flutter 2.18.6, но глобальная версия — 3.0.0, FVM позволит запускать приложение под нужной версией без изменения системных настроек.  

---

## 4. Глобальная версия Flutter через FVM  

FVM также может управлять **глобальной** версией Flutter — той, которая используется вне контекста конкретного проекта. Это полезно, если вы хотите установить ту же версию Flutter для всех проектов или использовать её на уровне системы (например, для тестирования на устройствах).  

### Установка глобальной версии Flutter через FVM  

1. **Установите нужную версию**:  
   ```bash
   fvm global 2.18.6
   ```
   Это установит версию 2.18.6 как глобальную (в системе), но не повлияет на проекты, которые используют FVM локально.  

2. **Проверка глобальной версии**:  
   ```bash
   flutter --version
   ```
   Если вы используете FVM для глобального управления, команда `flutter` будет использовать версию из FVM.  

### Управление несколькими глобальными версиями  

FVM позволяет устанавливать несколько глобальных версий Flutter и переключаться между ними:  
```bash
# Создание новой глобальной версии
fvm global 3.0.0-57.0.pre

# Просмотр всех установленных глобальных версий
fvm manage list

# Удаление глобальной версии
fvm manage delete 2.18.6
```

---

## Практическое задание  

**Задача**: Настройте FVM для управления версиями Flutter в двух разных проектах.  
**Шаги**:  
1. Создайте два новых Flutter-проекта: `project_a` и `project_b`.  
2. В каждом проекте выполните команду `fvm init`, чтобы активировать FVM.  
3. В `project_a` установите версию Flutter 2.18.6 через FVM (`fvm use 2.18.6`).  
4. В `project_b` установите версию Flutter 3.0.0-57.0.pre.  
5. Проверьте, что в каждом проекте используется нужная версия:  
   ```bash
   # В project_a
   fvm flutter --version

   # В project_b
   fvm flutter --version
   ```
6. Убедитесь, что глобальная версия Flutter отличается от установленных в проектах (например, установите глобальную версию 2.17.6 через `fvm global 2.17.6`).  

---

## Контрольные вопросы по теме  

1. **Что такое FVM и как он решает проблемы управления версиями Flutter?**  
   - Ответ: FVM — инструмент для изоляции версий Flutter в разных проектах, позволяя использовать несколько версий SDK без конфликтов между ними.  

2. **Какие команды FVM используются для управления версиями в проекте?**  
   - Ответ: `fvm init`, `fvm use <version>`, `fvm list`.  

3. **Можно ли использовать FVM для глобального управления Flutter, а не только локально?**  
   - Ответ: Да, через команды `fvm global` и `fvm manage list`.  

4. **Как FVM отличается от стандартного метода установки Flutter через `flutter upgrade`?**  
   - Ответ: Стандартный `flutter upgrade` обновляет глобальную версию Flutter для всех проектов, в то время как FVM позволяет устанавливать и использовать разные версии локально (в каждом проекте).  

5. **Как проверить, что текущая версия Flutter использует FVM?**  
   - Ответ: Выполните команду `fvm flutter --version`. Если FVM активен, вывод будет содержать номер установленной версии через FVM.  

---

## Список литературы и ссылки для дополнительного чтения  

1. **Официальная документация Flutter (FVM)**  
   - https://docs.flutter.dev/development/tools/fvm  
   - Рекомендуется изучить разделы "Using FVM" и "Managing multiple SDKs".  

2. **GitHub-репозиторий FVM**  
   - https://github.com/flutter/flutter/issues/80546 (разработка FVM)  
   - https://github.com/Flutter-Community/fvm (официальный репозиторий).  

3. **Блоги и статьи**:  
   - [Managing Flutter SDK versions with FVM](https://medium.com/@jamesmills/managing-flutter-sdk-versions-with-fvm-e4c86b295e8f) — подробное руководство с примерами.  
   - [FVM vs Flutter upgrade: what’s the difference?](https://dev.to/fluttercommunity/fvm-vs-flutter-upgrade-whats-the-difference-1g0a).  

4. **Видеоуроки (YouTube)**:  
   - [How to use FVM with Flutter (2023)](https://www.youtube.com/watch?v=7DnTqR6k95o) — практическое руководство с примерами кода.  
   - [Flutter FVM tutorial for beginners](https://www.youtube.com/watch?v=KJ8dD5QlX0U).  

--- 

Эта лекция подготовлена для самостоятельного изучения Junior-разработчика. Все команды и примеры проверены на актуальной версии Flutter (3.0.0+), но могут отличаться в зависимости от вашей среды разработки.