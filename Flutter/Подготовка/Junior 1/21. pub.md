### Лекция: `pubspec.yaml` в Flutter – управление зависимостями и метаданными проекта

---

#### **1. Общие сведения**

Файл `pubspec.yaml` — это основной конфигурационный файл для любого проекта на Dart/Flutter. Он содержит важную информацию о проекте, такие как его название, описание, версия, зависимости и другие метаданные. Также в этом файле указываются все библиотеки (пакеты), которые используются в проекте.

##### **Структура файла**
Файл `pubspec.yaml` разделён на несколько секций:
- **name**: Название вашего пакета.
- **description**: Краткое описание проекта или библиотеки.
- **version**: Версия проекта, которая соответствует [Semantic Versioning](https://semver.org/).
- **environment**: Указывает, какие версии Dart и Flutter поддерживаются вашим проектом.
- **dependencies**: Список зависимостей (библиотек), которые используются в проекте.
- **dev_dependencies**: Зависимости, используемые только при разработке (например, для тестирования или инструментов).
- **dependency_overrides**: Используется для переопределения версий пакетов, если они конфликтуют.
- **flutter**: Специфичные настройки для Flutter-приложений (например, поддержка Material Design).

##### **Пример файла `pubspec.yaml`**
```yaml
name: my_flutter_app
description: A new Flutter application.
version: 1.0.0+1

environment:
  sdk: ">=2.19.0 <3.0.0"
  flutter: ">=3.7.0"

dependencies:
  flutter:
    sdk: flutter
  http: ^0.13.5  # Зависимость для HTTP-запросов
  provider: ^6.0.4  # Используется для состояния приложения

dev_dependencies:
  flutter_test:
    sdk: flutter
  dart_dev: ^2.19.0  # Инструменты разработчика

flutter:
  uses-material-design: true
```

##### **Комментарии к примеру**
- `name`: Название проекта, важно для публикации на [pub.dev](https://pub.dev/).
- `version`: Формат `"1.0.0+1"`, где:
  - `1.0.0` — основная версия.
  - `+1` — номер сборки (build number), используется для обновлений без изменения функциональности.
- `environment.sdk`: Указывает, какие версии Dart поддерживаются вашим проектом.
- `dependencies`: Все пакеты, которые используются в проекте. Например:
  - `http` — библиотека для HTTP-запросов (в отличие от `dart:http`, которая устарела).
  - `provider` — используется для управления состоянием в Flutter.
- `dev_dependencies`: Инструменты, используемые только при разработке, например:
  - `flutter_test` — для тестирования UI и логики.
  - `dart_dev` — утилиты для отладки и анализа кода.
- `flutter.uses-material-design`: Включает поддержку Material Design компонентов.

---

#### **2. Указание версии зависимостей**

В Flutter вы можете указывать версии пакетов в нескольких форматах, которые влияют на обновления и стабильность проекта:

##### **Форматы указания версий**
1. **Точная версия** (`^0.13.5`):
   - Используется для фиксации конкретной версии пакета.
   - Пример: `http: ^0.13.5` — будет использоваться только версия 0.13.5.

2. **Диапазон версий с оператором `^`** (`^6.0.4`):
   - Позволяет использовать все версии, совместимые с указанной (например, 6.x.x).
   - Пример: `provider: ^6.0.4` — принимает версии от 6.0.4 до 7.0.0 (но не включая 7.0.0).

3. **Диапазон версий с оператором `~>`** (`~> 1.2.3`):
   - Позволяет использовать версии, которые совместимы с указанной мажорной/минорной версией.
   - Пример: `~> 6.0.4` — принимает все версии от 6.0.4 до 6.999.999 (но не включая 7.x.x).

4. **Диапазон версий с интервалом** (`>=1.2.3 <2.0.0`):
   - Определяет точный диапазон версий.
   - Пример: `~> 6.0.4` эквивалентен `>=6.0.4 <7.0.0`.

##### **Практическое применение**
- Используйте **точные версии** для критически важных зависимостей (например, библиотек, которые влияют на поведение приложения).
- Для большинства случаев используйте `^` — это упрощает обновление пакетов без риска поломки кода.
- Избегайте указания версий без ограничений (например, `0.13.5`) — это может привести к автоматическому обновлению до несовместимой версии.

##### **Пример**
```yaml
dependencies:
  http: ^0.13.5  # Использует версию >=0.13.5 <0.14.0
  provider: ~>6.0.4  # Использует версию >=6.0.4 <7.0.0
```

---

#### **3. dev_dependencies**

`dev_dependencies` — это список пакетов, которые используются только во время разработки (тестирование, отладка, анализ кода). Они **не включаются** в конечный бандл приложения, что позволяет уменьшить его размер.

##### **Примеры dev_dependencies**
- `flutter_test`: Для написания юнит-тестов и UI-тестов.
- `dart_dev`: Содержит инструменты для отладки кода (например, анализатор).
- `mockito`: Используется для создания мок-объектов в тестах.

##### **Практическое применение**
Если вы пишете юнит-тесты с использованием `test` и `mockito`, их нужно указать в `dev_dependencies`.

```yaml
dev_dependencies:
  flutter_test:
    sdk: flutter
  mockito: ^5.0.16
```

##### **Важно**
- Пакеты из `dev_dependencies` **не используются** в приложении, только на этапе разработки.
- Это помогает сохранить размер финального APK/APP (например, уменьшается вес для мобильных приложений).

---

#### **4. dependency_overrides**

Иногда зависимости могут конфликтовать между собой (например, одна библиотека требует версии `http: 0.12.0`, а другая — `http: 0.13.5`). В этом случае можно использовать `dependency_overrides` для принудительного указания нужной версии.

##### **Пример использования**
```yaml
dependency_overrides:
  http: ^0.13.5
```

##### **Риски и рекомендации**
- Используйте `dependency_overrides` только если вы уверены, что переопределение не сломает другие части проекта.
- Это может привести к тому, что при обновлении других пакетов возникнут конфликты.

##### **Когда использовать?**
- Если вы хотите принудительно установить конкретную версию пакета, которая совместима с вашим проектом.
- Например, если библиотека `provider` требует `dart: 2.19`, а ваша среда использует `dart: 2.18`.

---

#### **5. pub.dev**

[pub.dev](https://pub.dev/) — это официальный репозиторий пакетов для Dart и Flutter. Здесь разработчики могут:
- Публиковать свои библиотеки.
- Использовать готовые решения (например, `http`, `provider`, `flutter_bloc`).
- Следить за обновлениями и метриками популярности пакетов.

##### **Как использовать pub.dev**
1. **Поиск пакета**:
   - На сайте можно искать по названию (например, `http` или `provider`).

2. **Установка пакета**:
   - Добавьте его в `dependencies` вашего `pubspec.yaml`, как показано выше.

3. **Публикация своего пакета**:
   - Создайте аккаунт на [pub.dev](https://pub.dev/).
   - Подготовьте ваш проект: убедитесь, что он содержит документацию, примеры и `README.md`.
   - Используйте команду `dart pub publish` для публикации.

##### **Пример: публикация библиотеки**
```bash
# Убедитесь, что ваш проект готов к публикации (например, содержит dartdoc)
dart doc

# Публикуем пакет на pub.dev
dart pub publish --dry-run  # Сначала проверим, нет ли ошибок
dart pub publish
```

##### **Рекомендации**
- Добавьте `README.md` с описанием вашего пакета.
- Используйте `example/` для демонстрации использования.
- Включите тесты и убедитесь, что они проходят.

---

### **Практическое задание**

1. Создайте новый Flutter проект с помощью команды:
   ```bash
   flutter create my_flutter_app
   ```

2. Откройте файл `pubspec.yaml` и выполните следующие шаги:
   - Добавьте в `dependencies` пакет `http: ^0.13.5`.
   - Добавьте в `dev_dependencies` пакет `mockito: ^5.0.16`.

3. Убедитесь, что зависимости загружаются:
   ```bash
   flutter pub get
   ```

4. (Опционально): Используйте `dependency_overrides`, чтобы принудительно установить версию `http: ^0.12.5` и проверьте конфликты.

---

### **Контрольные вопросы**

1. Что такое `pubspec.yaml` и зачем он нужен?
2. Как указать точную версию зависимости в Flutter?
3. В чём разница между `dependencies` и `dev_dependencies`?
4. Что делает `dependency_overrides`? Когда его использовать?
5. Какие пакеты вы можете найти на [pub.dev](https://pub.dev/)?

---

### **Список литературы и ссылок**

1. Официальная документация Flutter: [https://docs.flutter.dev/](https://docs.flutter.dev/)
2. Руководство по публикации пакета на pub.dev: [https://pub.dev/packages/new](https://pub.dev/packages/new)
3. Semantic Versioning (SemVer): [https://semver.org/](https://semver.org/)
4. Документация Dart DevTools: [https://dart.dev/tools/devtools](https://dart.dev/tools/devtools)
5. Примеры использования `dependency_overrides`: [https://pub.dev/packages/flutter_bloc#dependencies](https://pub.dev/packages/flutter_bloc#dependencies)

---

### **Заключение**

Файл `pubspec.yaml` — это основа любого проекта на Flutter. Понимание его структуры, управления версиями и работы с зависимостями позволяет создавать устойчивые, модульные приложения. Умение использовать `dev_dependencies`, `dependency_overrides` и публиковать свои библиотеки на [pub.dev](https://pub.dev/) — ключевые навыки для любого разработчика Flutter.