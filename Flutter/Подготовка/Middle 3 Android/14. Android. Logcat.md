### Лекция: Android. Logcat (Уровень: Middle 3)

---

#### **14. Android. Logcat**

Logcat — это мощный инструмент для отладки и мониторинга работы приложений на платформе Android. Он позволяет разработчику в реальном времени анализировать логи, которые генерируются приложением, а также фильтровать их по уровням важности, тегам или текстовым шаблонам. Logcat является неотъемлемой частью экосистемы Android, обеспечивая возможность глубокого анализа поведения кода и выявления ошибок.

---

### **1. Назначение Logcat**

**Logcat** выполняет следующие ключевые функции:

- **Отладка приложений**: Позволяет визуализировать сообщения, генерируемые приложением (например, ошибки, предупреждения, информационные логи).
- **Мониторинг поведения кода**: Используется для отслеживания выполнения функций, проверки состояний переменных и анализа потоков исполнения.
- **Исследование производительности**: Интеграция с Android Profiler позволяет связывать логи с метриками, такими как CPU-загрузка или использование памяти.
- **Тестирование ошибок в реальных условиях**: Помогает выявлять баги и неожиданное поведение приложения на этапе разработки и тестирования.

**Пример использования:**
Представьте, что ваше приложение крашится после нажатия на кнопку. С помощью Logcat вы увидите сообщение об ошибке (например, NullPointerException), сможете определить, в какой строке кода произошел сбой, и исправить его.

**Как работает Logcat:**
- Все логи сохраняются в специальном буфере памяти устройства или эмулятора.
- Они могут быть прослушаны через Android Studio (вкладка "Logcat") или командную строку с помощью инструмента `adb`.
- Логи содержат информацию:
  - **Приоритет** (уровень важности).
  - **Тег** (идентификатор, связанный с определенной частью кода).
  - **Сообщение** (текст, описывающий событие).

---

### **2. Фильтрация логов**

Фильтрация позволяет уменьшить объем выводимой информации и сосредоточиться на конкретных частях кода или проблемах.

#### **Методы фильтрации:**

**1. По тегу (Tag)**
- Тег — это строка, которая связана с определенной частью кода (например, "MainActivity").
- В Android Studio можно ввести тег в поле "Filter" и выбрать тип фильтрации (`tag`).

**Пример:**
```kotlin
// Пример логирования с указанием тега
Log.d("MyAppTag", "Загрузка данных из базы")

// В Logcat введите в поле "Filter": 
// tag: MyAppTag
```

**2. По уровню приоритета (Priority)**
- Разработчик может отфильтровать логи по уровням важности (verbose, debug, info и т.д.).

**Пример:**
- Если вы хотите видеть только ошибки, введите в поле "Filter": `priority:error`.

**3. По тексту сообщения (Text)**
- Фильтрация по ключевым словам в самом логе.
- Например: если в сообщении встречается слово `"Ошибка"`, можно использовать фильтр: `text:Ошибка`.

#### **Использование командной строки (adb):**

```bash
# Отфильтровать все ошибки с тегом "MyAppTag"
adb logcat -s MyAppTag:error

# Показать только логи с уровнем debug
adb logcat -v long | grep "debug"
```

---

### **3. Уровни логирования**

Android поддерживает пять уровней приоритета для логов, которые определяют их важность и цвет в интерфейсе Logcat:

| Уровень        | Цвет      | Описание                                                                 |
|----------------|-----------|--------------------------------------------------------------------------|
| **Verbose**    | Синий     | Детальные сообщения, полезные для отладки (например, внутренние действия). |
| **Debug**      | Зелёный   | Информация о выполнении кода (например, включение/отключение функций).       |
| **Info**       | Жёлтый    | Обычные информационные сообщения (например, завершение операции).         |
| **Warn**       | Оранжевый | Предупреждения (например, использование устаревших методов).               |
| **Error**      | Красный   | Критические ошибки (например, краш приложения или сбой в работе функции).  |

#### **Примеры использования уровней логирования в Kotlin:**

```kotlin
import android.util.Log

class MainActivity : AppCompatActivity() {
    private val TAG = "MyAppTag"

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)

        // Уровень Verbose (используется редко, только для глубокой отладки)
        Log.v(TAG, "Вербозный лог: Инициализация приложения")

        // Уровень Debug
        Log.d(TAG, "Дебаг-лог: Загрузка данных из файла")

        // Уровень Info
        Log.i(TAG, "Информационный лог: Данные загружены успешно")

        // Уровень Warn (например, если значение отсутствует)
        Log.w(TAG, "Предупреждение: Нулевое значение в списке")

        // Уровень Error
        Log.e(TAG, "Ошибка: Не удалось сохранить данные")
    }
}
```

#### **Рекомендации по выбору уровней:**
- Используйте `Verbose` и `Debug` только для отладки.
- `Info` — для стандартных сообщений пользователя (например, "Данные обновлены").
- `Warn` — если приложение сталкивается с неожиданной ситуацией (но не крашится).
- `Error` — для критических ошибок, которые могут привести к крашу.

---

### **4. Логирование в Logcat**

#### **Стандартные методы логирования:**
Android предоставляет набор методов в классе `Log`, который находится в пакете `android.util.Log`.

| Метод          | Уровень приоритета | Описание                                                                 |
|----------------|--------------------|--------------------------------------------------------------------------|
| `Log.v()`      | Verbose            | Вывод детальной информации.                                              |
| `Log.d()`      | Debug              | Используется для отладки кода.                                           |
| `Log.i()`      | Info               | Информационные сообщения (например, успех операции).                      |
| `Log.w()`      | Warn               | Предупреждения о возможных проблемах.                                     |
| `Log.e()`      | Error              | Критические ошибки.                                                       |

#### **Пример:**
```kotlin
// Пример использования Log.d() и Log.e()
fun processUserInput(input: String?) {
    if (input.isNullOrEmpty()) {
        Log.w(TAG, "Пользователь ввёл пустое значение")
        return
    }

    try {
        val result = input.toInt()
        Log.i(TAG, "Входное значение преобразовано в число: $result")
    } catch (e: NumberFormatException) {
        Log.e(TAG, "Ошибка при преобразовании строки в число", e)
    }
}
```

#### **Дополнительные возможности:**
- **Прикрепление стека вызова**: Можно передать `Throwable` как второй аргумент методам `Log.e()` и `Log.w()`, чтобы получить полную информацию об ошибке.
- **Маркировка сообщений**: Используйте теги для группировки логов (например, `"NetworkManager"` или `"UserAuth"`).

---

### **Практическое задание**

**Задача:**
Создайте простое приложение на Kotlin с несколькими кнопками. Каждая кнопка должна генерировать логи разных уровней (verbose, debug, info, warn, error) с уникальным тегом и текстовым сообщением.

**Требования:**
1. Реализуйте 5 кнопок в интерфейсе.
2. При нажатии на каждую кнопку выводите соответствующий лог (например:
   - Кнопка "Verbose" → `Log.v("ButtonTag", "Нажата кнопка Verbose")`.
3. Используйте разные теги для каждой кнопки.
4. В Android Studio откройте Logcat и примените фильтры по уровню, тегу и тексту сообщения.

**Дополнительно:**
- Добавьте обработку ошибок (например, попытка деления на ноль) и используйте `Log.e()` для вывода ошибки с прикреплённым стеком вызова.

---

### **Контрольные вопросы**

1. Что такое Logcat и зачем он нужен?
2. Какие уровни логирования поддерживает Android? Приведите их описание.
3. Как отфильтровать логи по тегу в Android Studio?
4. Почему важно использовать разные уровни логов (например, не применять `Error` для незначительных ошибок)?
5. Как можно выводить стек вызова при ошибке в Logcat?
6. Что такое фильтрация по тексту и как это реализовать?
7. Приведите пример кода с использованием всех уровней логирования (`v`, `d`, `i`, `w`, `e`).
8. Как интегрировать Logcat с Android Profiler для анализа производительности?

---

### **Список литературы и ссылок**

1. **Официальная документация Google:**
   - [Android Logcat](https://developer.android.com/studio/command-line/logcat)
   - [Logging in Android](https://developer.android.com/guide/appendix/logging)

2. **Блоги и статьи:**
   - [Advanced Logging with Timber (Kotlin)](https://proandroiddev.com/advanced-logging-with-timber-in-kotlin-4b6e9a8d50c)
   - [Debugging Android Applications](https://www.techrepublic.com/article/debugging-android-applications-part-1-introduction-to-the-android-studio-debugger/)

3. **Книги:**
   - *Android Programming: The Big Nerd Ranch Guide* (2020) — глава о отладке и логировании.
   - *Kotlin for Android Developers* (by Antonio Leiva) — разделы, посвящённые `Log` и `adb`.

4. **Инструменты:**
   - [ADB Logcat Command Line Tool](https://developer.android.com/studio/command-line/adb#logcat)
   - [Android Studio Profiler](https://developer.android.com/studio/profile)

---

### **Заключение**

Logcat — это не просто инструмент для отладки, а основа успешного разработчика. Умение грамотно использовать уровни логирования и фильтрацию позволяет находить ошибки быстрее, улучшать производительность кода и повышать качество приложений. На этапе Middle 3 вы уже должны уверенно применять Logcat в реальных проектах, а также знать, как интегрировать его с другими инструментами анализа (например, Firebase Crashlytics или Android Profiler).