# Dart Generics

## 1. Введение в Generics
**Generics** (обобщения) — это механизм, позволяющий создавать компоненты, которые работают с различными типами данных, сохраняя при этом **типовую безопасность**. Они позволяют писать гибкий и переиспользуемый код без потери информации о типах.

### Зачем нужны Generics?
- **Типовая безопасность**: Избегайте ошибок, связанных с несоответствием типов.
- **Устранение дублирования**: Пишите один обобщенный код вместо множества версий для разных типов.
- **Читаемость**: Явно указывайте, с какими типами работает ваш код.

**Пример проблемы без Generics**:
```dart
class Box {
  dynamic content;

  Box(this.content);
}

void main() {
  Box intBox = Box(42);
  Box stringBox = Box("Hello");

  int value = intBox.content; // Ошибки нет, но тип dynamic!
  String text = stringBox.content; // Риск ошибки в runtime
}
```
Здесь `dynamic` скрывает реальный тип, что может привести к ошибкам.

---

## 2. Ключевое слово `dynamic` и его недостатки
**`dynamic`** — тип, который отключает статическую проверку типов. Переменная `dynamic` может содержать любое значение.

### Недостатки `dynamic`:
1. **Потеря безопасности типов**:
   ```dart
   void printLength(dynamic object) {
     print(object.length); // Ошибка в runtime, если object не имеет length
   }

   printLength(123); // Crash: int не имеет свойства length
   ```

2. **Сложность рефакторинга**: IDE не может подсказать доступные методы для `dynamic`.

3. **Снижение производительности**: Проверки типов выполняются в runtime.

**Generics vs dynamic**:
```dart
// С dynamic (плохо)
T firstDynamic<T>(List<dynamic> list) => list[0];

// С Generics (хорошо)
T first<T>(List<T> list) => list[0];
```
В первом случае теряется информация о типе элементов списка.

---

## 3. Generics в функциях
Используйте Generics, если функция должна работать с разными типами, сохраняя их специфику.

### Пример: Функция для получения первого элемента списка
```dart
// Без Generics (плохая практика)
dynamic firstElementDynamic(List list) => list.isEmpty ? null : list[0];

// С Generics
T? firstElement<T>(List<T> list) => list.isEmpty ? null : list[0];

void main() {
  List<int> numbers = [1, 2, 3];
  int? firstNum = firstElement(numbers); // Тип int?
  
  List<String> names = ["Alice", "Bob"];
  String? firstName = firstElement(names); // Тип String?
}
```

---

## 4. Generics в классах
Классы с Generics позволяют создавать универсальные структуры данных.

### Пример: Класс `Box<T>`
```dart
class Box<T> {
  T content;

  Box(this.content);

  T openBox() => content;
}

void main() {
  Box<int> intBox = Box(42);
  int value = intBox.openBox(); // Тип int

  Box<String> stringBox = Box("Secret");
  String text = stringBox.openBox(); // Тип String
}
```

### Пример из Flutter: `Future<T>`
```dart
Future<int> fetchNumber() async {
  await Future.delayed(Duration(seconds: 1));
  return 42;
}

void main() async {
  int number = await fetchNumber(); // Тип int
}
```

### Несколько типов в Generics
```dart
class Pair<K, V> {
  final K key;
  final V value;

  Pair(this.key, this.value);
}

void main() {
  Pair<int, String> pair = Pair(1, "Apple");
}
```

---

## 5. Практическое задание
**Задача 1**: Создайте класс `Cache<T>`, который хранит значения типа `T` по строковым ключам. Добавьте методы:
- `void put(String key, T value)`
- `T? get(String key)`

**Решение**:
```dart
class Cache<T> {
  final Map<String, T> _storage = {};

  void put(String key, T value) => _storage[key] = value;

  T? get(String key) => _storage[key];
}
```

**Задача 2**: Напишите функцию `List<T> mergeLists<T>(List<T> a, List<T> b)`, которая объединяет два списка в один.

**Решение**:
```dart
List<T> mergeLists<T>(List<T> a, List<T> b) => [...a, ...b];
```

---

## 6. Контрольные вопросы
1. Чем Generics лучше `dynamic`?
2. Как объявить функцию с Generics?
3. Можно ли использовать несколько типов в Generics (например, `Pair<K, V>`)?
4. Как Generics улучшают безопасность типов?
5. Приведите пример использования Generics в стандартной библиотеке Dart.

---

## 7. Литература
1. **Официальная документация**:  
   [Dart Generics](https://dart.dev/language/generics)
2. **Книги**:  
   - «Dart Apprentice» by Jonathan Sande
   - «Flutter Complete Reference» by Alberto Miola
3. **Статьи**:  
   - [Medium: Understanding Generics in Dart](https://medium.com/dartlang/dart-generics-2af3b21d1d1e)
   - [Flutter Docs: Type Safety](https://flutter.dev/docs/resources/type-system)